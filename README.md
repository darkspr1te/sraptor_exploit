		**SWD SRAM flash dumping aka - The sRaptor Exploit **

--POC code based off other works , code example by darkspr1te --


Original Idea from pdf found on offzone russia about STM clones exploits 
There was no available POC code so i decided to swrite my own - pun intended 

This code makes use of two SRAM based exploits for CKS -aka- cks32f103c8t6 and GD aka GigaDevices gd32f103cc based stm32f103 clones 
for the cks brand this should just work, for the gd32 devies you need to apply either power domain exploit or hope it's rdp1 
how to use :-

compile the code with build.sh file 

load up openocd and connect to target - some targets may need BOOT0 and BOOT1 changed, for cks targets you only need to change boot0 , for GD32 targets you need to connect under reset or better yet have BOOT0 & BOOT1 high *milage may vary

	
	openocd  -f interface/stlink.cfg  -f stm32f1x.cfg

	openocd  -f interface/ftdi/dp_busblaster_kt-link.cfg  -c 'transport select swd' -f gd32f103.cfg


then issue the following commands 
     
	 
	 reset halt

     load_image sram-code/uart.sram.elf

     resume 0x20000001


for cks it should just dump(UART2 code was used, if using UART1 code you must have access to PA0 or remove that line from the code) ,

	you should see a debug disconnect in openocd automaticaly 

*profit*

for GD32f device you must now disconnect Debug domain (disable CDBGPWRUPREQ) 
	gd32f103.dap 0x4 0x00
then you trigger the rest of the code to run, in the sample code I have PA0 connect to ground and to continue the dump you remove the short (this suited the device i was dumping) 
*profit*



if connected correctly to (UART1 PA9/PA10) or (UART2 PA2/PA3) then you will see the flash dump via uart


*notes*
to use the stm32f103.cfg on cks targets you need to change the ID from  0x1ba01477 to 0x2ba01477 
just copy it to local place and edit the use -f stm32f103.cfg to load local file 


code should be injectable into binaries too tested on 2 Logitech keyboards


**code is provided for educational purpose only ** 

i've nicknamed this the sRaptor exploit 

darkspr1te - 12-12-2023


* bug notice * 
the code drops the first 0x00 so after you have dumped the flash insert one zero at the start of the file 
so 09 00 20 0D
becomes 
00 09 00 20 0D
yes i could add code to fix it but it's a simple issue and the code that makes it work on GD32 devices breaks CKS devices on dump but both have the issue (odly so does STM32f103c8) 


